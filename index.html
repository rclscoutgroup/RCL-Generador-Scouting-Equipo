<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador Informe de Equipo - RCL Scout</title>
    <style>
        :root {
            --primary: #0e2b4b; /* Azul RCL */
            --secondary: #f4f6f8;
            --accent: #2c5282;
            --text: #333;
            --border: #ddd;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--secondary);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        /* --- ESTILOS DE IMPRESI√ìN (PDF) --- */
        @page { 
            size: A4; 
            margin: 1cm; 
        }
        
        @media print {
            body { background: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .container { box-shadow: none; max-width: 100%; width: 100%; padding: 0; margin: 0; }
            
            /* Evitar cortes de p√°gina feos */
            .page-break-avoid { page-break-inside: avoid; }
            h2, h3 { color: var(--primary) !important; border-bottom-color: var(--primary) !important; }
            
            /* Ajustes de tabla para imprimir */
            table { font-size: 10px; width: 100%; }
            th { background-color: var(--primary) !important; color: white !important; }
            
            /* Enlaces */
            a { text-decoration: none; color: var(--accent); font-weight: bold; }
        }

        /* --- INTERFAZ EDITOR (Pantalla) --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid var(--primary); padding-bottom: 20px; }
        h1 { color: var(--primary); margin: 0; text-transform: uppercase; letter-spacing: 1px; }

        .form-section { margin-bottom: 30px; border: 1px solid #eee; padding: 20px; border-radius: 8px; }
        .form-section h3 { margin-top: 0; color: var(--primary); border-bottom: 1px solid #eee; padding-bottom: 10px; }

        .row { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 15px; }
        .col { flex: 1; min-width: 250px; }
        
        label { display: block; font-size: 0.85em; font-weight: bold; color: #555; margin-bottom: 5px; }
        input[type="text"], input[type="date"], textarea { 
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; 
            box-sizing: border-box; font-family: inherit; font-size: 0.95em;
        }
        textarea { height: 80px; resize: vertical; }

        /* Estilos Tabla Editor */
        .input-table { width: 100%; border-collapse: collapse; }
        .input-table th { background: #eee; padding: 8px; text-align: left; font-size: 0.85em; }
        .input-table td { padding: 5px; }
        .input-table input { width: 100%; padding: 6px; }

        .btn-generate {
            display: block; width: 100%; padding: 15px; margin-top: 30px;
            background: #28a745; color: white; font-size: 1.2em; font-weight: bold;
            border: none; border-radius: 5px; cursor: pointer; transition: 0.3s;
        }
        .btn-generate:hover { background: #218838; }

        /* --- VISTA PREVIA / REPORTE FINAL --- */
        .print-only { display: none; }
        
        .report-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 3px solid var(--primary); padding-bottom: 15px; margin-bottom: 20px; }
        .report-logo { height: 80px; width: auto; object-fit: contain; }

        .match-banner {
            display: flex; align-items: center; justify-content: space-between;
            background: #f8f9fa; border: 1px solid #ddd; padding: 15px; border-radius: 5px; margin-bottom: 20px;
        }
        .team-box { text-align: center; flex: 1; font-weight: bold; color: var(--primary); font-size: 1.2em; }
        .team-crest-img { height: 60px; object-fit: contain; display: block; margin: 0 auto 5px auto; }
        .score-box { font-size: 2em; font-weight: bold; color: #333; padding: 0 20px; }

        .meta-grid { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; 
            font-size: 0.9em; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; 
        }

        /* Formaciones en el reporte */
        .formations-container { display: flex; justify-content: space-between; gap: 20px; margin-bottom: 20px; }
        .formation-box { width: 48%; text-align: center; border: 1px solid #eee; padding: 5px; }
        .formation-img { width: 100%; max-height: 350px; object-fit: contain; }

        /* Tablas Reporte */
        .report-table { width: 100%; border-collapse: collapse; font-size: 0.9em; margin-bottom: 20px; table-layout: fixed; }
        .report-table th { background: var(--primary); color: white; padding: 6px; text-align: left; }
        .report-table td { border-bottom: 1px solid #ddd; padding: 6px; vertical-align: top; word-wrap: break-word; }
        
        /* Columnas espec√≠ficas */
        .col-pos { width: 8%; text-align: center; font-weight: bold; }
        .col-name { width: 25%; font-weight: 600; }
        .col-com { width: 42%; }
        .col-rec { width: 15%; }
        .col-val { width: 10%; text-align: center; font-weight: bold; }

        /* Cajas de An√°lisis */
        .analysis-box { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dotted #ccc; }
        .analysis-title { font-weight: bold; font-size: 1.1em; color: var(--primary); display: block; margin-bottom: 5px; }
        
        .video-btn {
            display: inline-block; margin-top: 5px; font-size: 0.85em; 
            color: #d93025; font-weight: bold; text-decoration: none; 
            background: #fff0f0; padding: 4px 8px; border-radius: 4px; border: 1px solid #ffcccc;
        }

    </style>
</head>
<body>

<div class="container no-print" id="editorInterface">
    <header>
        <h1>Generador Informe de Equipo</h1>
        <p>RCL Scout Group</p>
        <div style="background:#eef; padding:10px; border-radius:5px; text-align: left; margin-top:10px;">
            <label>Logo de la Empresa (RCL):</label>
            <input type="file" id="inp_logo" accept="image/*">
        </div>
    </header>

    <div class="form-section">
        <h3>1. Detalles del Partido</h3>
        <div class="row">
            <div class="col">
                <label>Fecha</label><input type="date" id="inp_date">
                <label>Competici√≥n</label><input type="text" id="inp_comp">
                <label>Lugar / Estadio</label><input type="text" id="inp_venue">
                <label>Scout</label><input type="text" id="inp_scout">
            </div>
            <div class="col">
                <label>Equipo Local</label><input type="text" id="inp_home">
                <label>Escudo Local</label><input type="file" id="inp_crest_home" accept="image/*">
                
                <label>Equipo Visitante</label><input type="text" id="inp_away">
                <label>Escudo Visitante</label><input type="file" id="inp_crest_away" accept="image/*">
                
                <label>Resultado Final</label><input type="text" id="inp_score" placeholder="Ej: 2 - 1">
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>2. Formaciones</h3>
        <div class="row">
            <div class="col"><label>Pizarra Local</label><input type="file" id="inp_form_home" accept="image/*"></div>
            <div class="col"><label>Pizarra Visitante</label><input type="file" id="inp_form_away" accept="image/*"></div>
        </div>
    </div>

    <div class="form-section">
        <h3>3. Evaluaci√≥n de Jugadores</h3>
        <p style="font-size:0.8em; color:#666;">XI Inicial (Dejar filas vac√≠as si no son necesarias)</p>
        <table class="input-table" id="table_xi">
            <thead>
                <tr>
                    <th width="10%">Pos</th>
                    <th width="25%">Nombre</th>
                    <th>Comentario</th>
                    <th width="15%">Rec</th>
                    <th width="10%">Val (0-10)</th>
                </tr>
            </thead>
            <tbody></tbody> </table>

        <p style="font-size:0.8em; color:#666; margin-top:20px;">Suplentes</p>
        <table class="input-table" id="table_subs">
            <thead>
                <tr>
                    <th width="10%">Pos</th>
                    <th width="25%">Nombre</th>
                    <th>Comentario</th>
                    <th width="15%">Rec</th>
                    <th width="10%">Val (0-10)</th>
                </tr>
            </thead>
            <tbody></tbody> </table>
    </div>

    <div class="form-section">
        <h3>4. An√°lisis y Resumen</h3>
        
        <label>Resumen del Partido</label>
        <textarea id="inp_ana_sum"></textarea>
        <input type="text" id="vid_ana_sum" placeholder="Enlace al v√≠deo del Resumen">
        
        <label style="margin-top:15px;">An√°lisis Equipo Local</label>
        <textarea id="inp_ana_home"></textarea>
        <input type="text" id="vid_ana_home" placeholder="Enlace al v√≠deo An√°lisis Local">

        <label style="margin-top:15px;">An√°lisis Equipo Visitante</label>
        <textarea id="inp_ana_away"></textarea>
        <input type="text" id="vid_ana_away" placeholder="Enlace al v√≠deo An√°lisis Visitante">
    </div>

    <button class="btn-generate" onclick="generateReport()">Generar Informe y Vista Previa</button>
</div>


<div class="container print-only" id="reportInterface" style="display:none; margin-top:20px;">
    
    <div class="report-header">
        <div>
            <h1 style="font-size:24px; margin:0; color:#0e2b4b;">INFORME DE EQUIPO</h1>
            <span style="color:#666; font-size:12px;">RCL Scout Group &copy; 2025</span>
        </div>
        <img id="out_logo" src="" class="report-logo" style="display:none;">
    </div>

    <div class="match-banner">
        <div class="team-box">
            <img id="out_crest_home" class="team-crest-img" src="" style="display:none;">
            <div id="out_home">Local</div>
        </div>
        <div class="score-box" id="out_score">vs</div>
        <div class="team-box">
            <img id="out_crest_away" class="team-crest-img" src="" style="display:none;">
            <div id="out_away">Visitante</div>
        </div>
    </div>

    <div class="meta-grid">
        <div><strong>Fecha:</strong> <span id="out_date"></span></div>
        <div><strong>Competici√≥n:</strong> <span id="out_comp"></span></div>
        <div><strong>Estadio:</strong> <span id="out_venue"></span></div>
        <div><strong>Scout:</strong> <span id="out_scout"></span></div>
    </div>

    <h3 style="border-bottom:1px solid #ccc; color:#0e2b4b;">Formaciones</h3>
    <div class="formations-container">
        <div class="formation-box">
            <strong>Local</strong><br>
            <img id="out_form_home" class="formation-img" style="display:none;">
        </div>
        <div class="formation-box">
            <strong>Visitante</strong><br>
            <img id="out_form_away" class="formation-img" style="display:none;">
        </div>
    </div>

    <h3 style="border-bottom:1px solid #ccc; color:#0e2b4b;">Evaluaci√≥n de Jugadores</h3>
    <div id="render_tables_area">
        </div>

    <div class="page-break-avoid" style="margin-top:20px;">
        <h3 style="border-bottom:1px solid #ccc; color:#0e2b4b;">Resumen y An√°lisis</h3>
        
        <div class="analysis-box">
            <span class="analysis-title">Resumen del Partido</span>
            <div id="out_ana_sum" style="white-space: pre-wrap; font-size:0.95em;"></div>
            <a id="lnk_ana_sum" class="video-btn" target="_blank" style="display:none;">üì∫ Ver V√≠deo Resumen</a>
        </div>

        <div class="analysis-box">
            <span class="analysis-title">An√°lisis Equipo Local</span>
            <div id="out_ana_home" style="white-space: pre-wrap; font-size:0.95em;"></div>
            <a id="lnk_ana_home" class="video-btn" target="_blank" style="display:none;">üì∫ Ver V√≠deo Local</a>
        </div>

        <div class="analysis-box">
            <span class="analysis-title">An√°lisis Equipo Visitante</span>
            <div id="out_ana_away" style="white-space: pre-wrap; font-size:0.95em;"></div>
            <a id="lnk_ana_away" class="video-btn" target="_blank" style="display:none;">üì∫ Ver V√≠deo Visitante</a>
        </div>
    </div>

    <div class="no-print" style="margin-top:40px; text-align:center; padding:20px; border-top:2px dashed #ccc; background:#fff;">
        <p><strong>Vista Previa Generada.</strong> Si todo est√° correcto, pulsa imprimir.</p>
        <button onclick="window.print()" style="padding:12px 25px; background:#0e2b4b; color:white; border:none; cursor:pointer; font-size:1.1em; border-radius:5px; margin-right:10px;">üñ®Ô∏è Guardar como PDF</button>
        <button onclick="editMode()" style="padding:12px 25px; background:#777; color:white; border:none; cursor:pointer; font-size:1.1em; border-radius:5px;">‚úèÔ∏è Volver a Editar</button>
    </div>
</div>

<script>
    // Almac√©n de im√°genes en Base64
    const images = {};

    // 1. Inicializaci√≥n: Crear filas de tablas al cargar
    window.onload = function() {
        createInputRows('table_xi', 11);
        createInputRows('table_subs', 9);
    };

    function createInputRows(tableId, count) {
        const tbody = document.querySelector(`#${tableId} tbody`);
        for(let i=0; i<count; i++) {
            tbody.innerHTML += `
            <tr>
                <td><input type="text" class="i-pos"></td>
                <td><input type="text" class="i-name"></td>
                <td><input type="text" class="i-com"></td>
                <td><input type="text" class="i-rec"></td>
                <td><input type="text" class="i-val" style="text-align:center;"></td>
            </tr>`;
        }
    }

    // 2. Manejador de subida de im√°genes
    document.addEventListener('change', function(e) {
        if (e.target.type === 'file') {
            const id = e.target.id;
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(evt) { images[id] = evt.target.result; };
                reader.readAsDataURL(file);
            }
        }
    });

    // 3. Funci√≥n Principal: Generar Informe
    function generateReport() {
        // Intercambiar vistas
        document.getElementById('editorInterface').style.display = 'none';
        document.getElementById('reportInterface').style.display = 'block';
        window.scrollTo(0,0);

        // --- Transferir Textos B√°sicos ---
        setText('inp_date', 'out_date');
        setText('inp_comp', 'out_comp');
        setText('inp_venue', 'out_venue');
        setText('inp_scout', 'out_scout');
        setText('inp_home', 'out_home');
        setText('inp_away', 'out_away');
        setText('inp_score', 'out_score');

        // --- Transferir Im√°genes ---
        setImage('inp_logo', 'out_logo');
        setImage('inp_crest_home', 'out_crest_home');
        setImage('inp_crest_away', 'out_crest_away');
        setImage('inp_form_home', 'out_form_home');
        setImage('inp_form_away', 'out_form_away');

        // --- Generar Tablas (Filtrando vac√≠as) ---
        let tablesHTML = "";
        tablesHTML += buildReportTable('table_xi', 'XI Inicial');
        tablesHTML += buildReportTable('table_subs', 'Suplentes');
        document.getElementById('render_tables_area').innerHTML = tablesHTML;

        // --- Transferir An√°lisis y Links ---
        setAnalysis('inp_ana_sum', 'out_ana_sum', 'vid_ana_sum', 'lnk_ana_sum');
        setAnalysis('inp_ana_home', 'out_ana_home', 'vid_ana_home', 'lnk_ana_home');
        setAnalysis('inp_ana_away', 'out_ana_away', 'vid_ana_away', 'lnk_ana_away');
    }

    // Volver atr√°s
    function editMode() {
        document.getElementById('reportInterface').style.display = 'none';
        document.getElementById('editorInterface').style.display = 'block';
        window.scrollTo(0,0);
    }

    // --- Funciones Auxiliares ---

    function setText(srcId, destId) {
        const val = document.getElementById(srcId).value;
        document.getElementById(destId).innerText = val;
    }

    function setImage(srcId, destId) {
        if(images[srcId]) {
            const el = document.getElementById(destId);
            el.src = images[srcId];
            el.style.display = 'inline-block';
        }
    }

    function buildReportTable(sourceTableId, title) {
        const rows = document.querySelectorAll(`#${sourceTableId} tbody tr`);
        let htmlRows = "";
        let hasData = false;

        rows.forEach(r => {
            const pos = r.querySelector('.i-pos').value;
            const name = r.querySelector('.i-name').value;
            const com = r.querySelector('.i-com').value;
            const rec = r.querySelector('.i-rec').value;
            const val = r.querySelector('.i-val').value;

            // Solo a√±adimos la fila si hay nombre escrito
            if(name.trim() !== "") {
                hasData = true;
                htmlRows += `
                <tr>
                    <td class="col-pos">${pos}</td>
                    <td class="col-name">${name}</td>
                    <td class="col-com">${com}</td>
                    <td class="col-rec">${rec}</td>
                    <td class="col-val">${val}</td>
                </tr>`;
            }
        });

        if (hasData) {
            return `
            <h4 style="margin: 15px 0 5px 0; color:#555;">${title}</h4>
            <table class="report-table">
                <thead>
                    <tr>
                        <th class="col-pos">Pos</th>
                        <th class="col-name">Nombre</th>
                        <th class="col-com">Comentario</th>
                        <th class="col-rec">Rec</th>
                        <th class="col-val">Val</th>
                    </tr>
                </thead>
                <tbody>${htmlRows}</tbody>
            </table>`;
        } else {
            return ""; // Si no hay datos, no devolvemos nada
        }
    }

    function setAnalysis(txtSrc, txtDest, vidSrc, lnkDest) {
        const text = document.getElementById(txtSrc).value;
        const vidUrl = document.getElementById(vidSrc).value;
        const txtEl = document.getElementById(txtDest);
        const lnkEl = document.getElementById(lnkDest);

        txtEl.innerText = text;
        
        if (vidUrl.trim() !== "") {
            lnkEl.href = vidUrl;
            lnkEl.style.display = "inline-block";
        } else {
            lnkEl.style.display = "none";
        }
    }

</script>

</body>
</html>
